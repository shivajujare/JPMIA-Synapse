{
	"name": "1_ext_tables_uv",
	"properties": {
		"content": {
			"query": "create MASTER KEY ENCRYPTION BY PASSWORD = 'jpmia#2188';\n\ndrop CREDENTIAL uv_sas_token;\nalter DATABASE SCOPED CREDENTIAL uv_sas_token WITH IDENTITY = 'SHARED ACCESS SIGNATURE',\nSECRET = 'sv=2022-11-02&ss=b&srt=sco&sp=rwdlacyx&se=2024-04-05T13:03:44Z&st=2024-03-24T05:03:44Z&spr=https&sig=ck1ArJAeEa9eY6ApvcczH3G%2BhcvECzhJmHKe94m%2Fw6E%3D';\n\ndrop EXTERNAL DATA SOURCE ext_usage_view\ncreate EXTERNAL DATA SOURCE ext_usage_view\nwith (\n    LOCATION='https://adlsjpmia.blob.core.windows.net/jpmiadata/usage_view/',\n    CREDENTIAL = uv_sas_token\n);\n\ndrop EXTERNAL DATA SOURCE ext_biz_view_\ncreate EXTERNAL DATA SOURCE ext_biz_view\nwith (\n    LOCATION='https://adlsjpmia.blob.core.windows.net/jpmiadata/biz_view/',\n    CREDENTIAL = uv_sas_token\n);\n\n--DROP EXTERNAL TABLE jpmia.DimCompanies;\nCREATE EXTERNAL FILE FORMAT uv_delta_format\nWITH (\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec' -- Optional: specify compression codec\n);\n\nDROP TABLE jpmia_ext.DimCompanies;\ndrop table \nCREATE EXTERNAL table jpmia_ext.DimCompanies\n(\n    company_id bigint,\n            name NVARCHAR(200),\n           description NVARCHAR(MAX),\n           company_size int,\n           formatted_company_size NVARCHAR(50),\n           state NVARCHAR(100),\n           country NVARCHAR(100),\n           city NVARCHAR(1000),\n           zip_code NVARCHAR(100),\n           address NVARCHAR(3000),\n           url NVARCHAR(1000),\n           ingest_date date\n)\nWITH(\n    LOCATION = 'DimCompanies',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nselect TOP 100 ingest_date from jpmia_ext.DimCompanies;\n\n------------\ndrop TABLE if EXISTS jpmia_ext.DimCompanyIndustries\nCREATE EXTERNAL table jpmia_ext.DimCompanyIndustries\n(\n    company_id bigint,\n  industries NVARCHAR(1000),\n  ingest_date date\n)\nWITH(\n    LOCATION = 'DimCompanyIndustries',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nselect top 10 * from jpmia_ext.DimCompanyIndustries;\n\n----------------\n\nCREATE EXTERNAL table jpmia_ext.DimCompanySpecialities(\n  company_id bigint,\n  specialities NVARCHAR(3000),\n  ingest_date date\n)\nWITH(\n    LOCATION = 'DimCompanySpecialities',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nSELECT top 10 * from jpmia_ext.DimCompanySpecialities;\n\n-----------------\n\nCREATE EXTERNAL table jpmia_ext.DimJobBenefits(\n  job_id bigint,\n  inferred VARCHAR(10),\n  type VARCHAR(2000),\n  ingest_date date\n  )\nWITH(\n    LOCATION = 'DimJobBenefits',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nselect * from jpmia_ext.DimJobBenefits;\n\n------------------\n\n\n\nCREATE EXTERNAL table jpmia_ext.DimJobSkills(\n  job_id\tbigint,\n  skill_abr NVARCHAR(1000),\n  skill_name NVARCHAR(2000),\n  ingest_date date\n  )\nWITH(\n    LOCATION = 'DimJobSkills',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nselect top 10 * from jpmia_ext.DimJobSkills;\n\n-------------\n\nCREATE EXTERNAL table jpmia_ext.FactCompanyEmployeeGrowth\n(\n  company_id bigint,\n  employee_count bigint,\n  follower_count bigint,\n  time_recorded NVARCHAR(1000),\n  date_time_recorded DATETIME2,\n  date_recorded date,\n  total_employees_as_of_now bigint,\n  total_followers_as_of_now bigint,\n  ingest_date date\n  )\nWITH(\n    LOCATION = 'FactCompanyEmployeeGrowth',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nSELECT * from jpmia_ext.FactCompanyEmployeeGrowth;\n\n-------------\ndrop EXTERNAL TABLE jpmia_ext.DimJobIndustries;\nCREATE EXTERNAL table jpmia_ext.DimJobIndustries(\n  job_id\tbigint,\n  industry_id bigint,\n  industry_name NVARCHAR(1000),\n  ingest_date date\n  )\nWITH(\n    LOCATION = 'DimJobIndustries',\n    DATA_SOURCE = ext_usage_view,\n    FILE_FORMAT = uv_delta_format\n)\ngo;\n\nSELECT * from jpmia_ext.DimJobIndustries;\n\n--------\n\nCREATE EXTERNAL table jpmia_ext.DimJobSalaries\n(\n    salary_id bigint,\n  job_id bigint,\n  max_salary float,\n  med_salary float,\n  min_salary float,\n  pay_period NVARCHAR(100),\n  currency NVARCHAR(10),\n  compensation_type NVARCHAR(100),\n  ingest_date date\n)\nWITH(\n    LOCATION = 'job_salaries',\n    DATA_SOURCE = ext_biz_view,\n    FILE_FORMAT=uv_delta_format\n);\n\nselect top 10 * from jpmia_ext.DimJobSalaries;\n\n-------\n\nCREATE EXTERNAL table jpmia_ext.FactJobPostings\n(\n    job_id bigint, \n   title NVARCHAR(3000),\n  company_id bigint,\t\n  locations NVARCHAR(500),\t\n  applies int,\t\n  original_listed_time NVARCHAR(100),\t\n  remote_allowed NVARCHAR(10),\t\n  views int,\t\n  job_posting_url\tNVARCHAR(1000), \n  application_url NVARCHAR(1000),\t\n  application_type NVARCHAR(1000),\t\n  expiry NVARCHAR(100),\t\n  closed_time NVARCHAR(100),\t\n  experience_level NVARCHAR(100),\t\n  listed_time NVARCHAR(100),\t\n  posting_domain NVARCHAR(100),\t\n  sponsored NVARCHAR(100),\t\n  work_type NVARCHAR(100),\t\n  scraped NVARCHAR(100),\n  ingest_date date\n)\nWITH(\n    LOCATION = 'job_postings',\n    DATA_SOURCE = ext_biz_view,\n    FILE_FORMAT=uv_delta_format\n);\n\nselect top 10 * from jpmia_ext.FactJobPostings;\n\nSELECT * from sys.tables;",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "JobPulse_MarketInsightAnalytics",
				"poolName": "JobPulse_MarketInsightAnalytics"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}